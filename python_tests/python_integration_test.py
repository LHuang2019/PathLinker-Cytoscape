'''
Thescript creates an simple CytoScape network using data from the test text file
    and run PathLinker via API request to generate new sub-graph/view and k-number paths in JSON format
'''
from py2cytoscape.data.cynetwork import CyNetwork
from py2cytoscape.data.cyrest_client import CyRestClient

import networkx as nx
import pandas as pd
import json
import requests
from requests.status_codes import codes

# create an instance of cyRest client
cy = CyRestClient()

# reset the session
cy.session.delete()

# create a new network from the input txt file using pandas
network_csv = pd.read_csv('../src/test/resources/input/graph-undir_human-interactome.txt', header=None, sep='\t', lineterminator='\n')

# create an empty undirected graph from networkx
nx_network = nx.Graph()

# fill the empty network with source, target, and corresponding edge weight
for row in network_csv.itertuples():
    nx_network.add_edge(row[1], row[2], weight=row[3])

# create the CyNetwork object from the networkx in cytoscape under network collection
cy_network = cy.network.create_from_networkx(nx_network, collection = 'Generated by NetworkX')

cy_network_suid = cy_network.get_id() # obtain network object SUID

# construct PathLinker input data for API request
input_data = {}
input_data["sources"] = "P35968 P00533 Q02763"
input_data["targets"] = "Q15797 Q14872 Q16236 P14859 P36956"
input_data["allowSourcesTargetsInPaths"] = False
input_data["includeTiedPaths"] = False
input_data["k"] = 50
input_data["edgeWeightSetting"] = "ADDITIVE"
input_data["edgePenalty"] = 1
input_data["edgeWeightColumnName"] = "weight"
input_data["generateKSPSubgraph"] = True

headers = {'Content-Type': 'application/json', 'Accept': 'application/json'}
result = requests.request("POST",
                            "http://localhost:1234/pathlinker/v1.4/" + str(cy_network_suid) + "/runPathLinker",
                            data = json.dumps(input_data),
                            params = None,
                            headers = headers)

print(result.content)
